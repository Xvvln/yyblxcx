# 营养不良筛查与健康管理小程序 - 完整安装手册

## 项目概述

这是一个基于 uni-app + Vue 3 + FastAPI + MySQL 的全栈健康管理小程序，包含以下功能模块：
- 健康筛查与评估
- 运动打卡与记录
- 饮食记录与分析
- 商城购物
- 社区互动
- AI健康咨询
- 会员管理系统
- 后台管理系统

---

## 📋 目录

1. [环境要求](#环境要求)
2. [项目结构](#项目结构)
3. [快速开始（克隆项目后）](#快速开始克隆项目后)
4. [环境搭建](#环境搭建)
5. [数据库配置](#数据库配置)
6. [后端部署](#后端部署)
7. [前端部署](#前端部署)
8. [管理后台部署](#管理后台部署)
9. [项目启动](#项目启动)
10. [数据迁移](#数据迁移)
11. [测试验证](#测试验证)
12. [常见问题](#常见问题)
13. [部署清单](#部署清单)

---

## ⚠️ 安全说明

本项目使用环境变量管理敏感配置信息。以下文件**不会**被提交到 Git 仓库：

| 文件 | 说明 |
|-----|------|
| `backend/.env` | 后端环境变量（数据库密码、密钥等） |
| `database_backup/*.sql` | 数据库备份文件 |

克隆项目后，请按照 [快速开始](#快速开始克隆项目后) 章节配置环境变量。

---

## 环境要求

### 必需软件

| 软件名称 | 版本要求 | 下载地址 | 说明 |
|---------|---------|---------|------|
| **Node.js** | 18.x+ | https://nodejs.org | 前端构建运行环境 |
| **Python** | 3.10+ | https://python.org | 后端运行环境 |
| **MySQL** | 8.0+ | https://mysql.com | 数据库服务器 |
| **HBuilderX** | 最新版 | https://www.dcloud.io/hbuilderx.html | uni-app开发工具 |
| **微信开发者工具** | 最新版 | https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html | 小程序调试工具 |

### 可选软件

| 软件名称 | 版本要求 | 说明 |
|---------|---------|------|
| **Redis** | 6.x+ | 缓存服务（可选） |
| **Git** | 最新版 | 版本控制 |

---

## 项目结构

```
营养不良筛查与健康管理小程序/
├── admin-web/                 # 管理后台前端 (Vue 3 + Element Plus)
├── backend/                   # Python后端 (FastAPI)
├── docs/                      # 项目文档
├── pages/                     # 小程序页面
├── static/                    # 小程序静态资源
├── stores/                    # Pinia状态管理
├── utils/                     # 工具函数
├── components/                # 公共组件
├── database_backup/           # 数据库备份文件 (运行导出脚本后生成)
├── export_database.bat        # 数据库导出脚本
├── import_database.bat        # 数据库导入脚本
├── package.json               # 小程序依赖配置
├── pages.json                 # 小程序页面配置
├── manifest.json              # 小程序清单配置
└── 完整安装手册.md           # 本文档
```

---

## 快速开始（克隆项目后）

> 🚀 如果你是从 GitHub 克隆本项目，请按以下步骤配置环境变量

### 第一步：配置后端环境变量

```bash
# 1. 进入后端目录
cd backend

# 2. 复制环境变量模板
cp .env.example .env

# 3. 编辑 .env 文件
notepad .env      # Windows
# nano .env       # Linux/Mac
```

### 第二步：修改 `.env` 配置

打开 `backend/.env` 文件，修改以下配置项：

```env
# 数据库配置 - 将 your_password 改为你的 MySQL 密码
DATABASE_URL=mysql+aiomysql://root:your_password@localhost:3306/health_db

# JWT 密钥 - 生产环境请使用随机字符串
# 可用命令生成: openssl rand -hex 32
JWT_SECRET_KEY=your-super-secret-key-change-in-production

# 微信小程序配置 - 在微信公众平台获取
WECHAT_APPID=your_wechat_appid
WECHAT_SECRET=your_wechat_secret

# AI 服务（可选）- 在阿里云百炼获取
DASHSCOPE_API_KEY=
```

### 第三步：创建数据库

```bash
# 使用 MySQL 命令行或图形工具创建数据库
mysql -u root -p
```

```sql
CREATE DATABASE health_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 第四步：导入数据（如有备份）

如果有数据库备份文件，运行导入脚本：

```bash
# 回到项目根目录
cd ..

# 运行导入脚本（会提示输入密码）
import_database.bat
```

### 第五步：安装依赖并启动

```bash
# 后端
cd backend
pip install -r requirements.txt
python run.py

# 小程序前端（新终端）
cd ..
npm install
npm run dev:mp-weixin

# 管理后台（新终端）
cd admin-web
npm install
npm run dev
```

### 环境变量配置表

| 变量名 | 必填 | 说明 | 获取方式 |
|--------|------|------|---------|
| `DATABASE_URL` | ✅ | MySQL 连接字符串 | 修改密码部分即可 |
| `JWT_SECRET_KEY` | ✅ | JWT 签名密钥 | 运行 `openssl rand -hex 32` |
| `WECHAT_APPID` | ⚠️ | 微信小程序 AppID | [微信公众平台](https://mp.weixin.qq.com/) |
| `WECHAT_SECRET` | ⚠️ | 微信小程序密钥 | [微信公众平台](https://mp.weixin.qq.com/) |
| `DASHSCOPE_API_KEY` | ❌ | 阿里云 AI API Key | [阿里云百炼](https://dashscope.console.aliyun.com/) |

> ⚠️ 微信配置：开发测试时可留空，但登录功能将不可用  
> ❌ 可选配置：不填写时相关功能将不可用

---

## 环境搭建

### 1. Node.js 安装

1. 下载并安装 Node.js 18.x+
2. 验证安装：
```bash
node --version
npm --version
```

### 2. Python 安装

1. 下载并安装 Python 3.10+
2. 验证安装：
```bash
python --version
pip --version
```

### 3. MySQL 安装

1. 下载并安装 MySQL 8.0+
2. 启动 MySQL 服务：
```bash
# Windows
net start mysql80

# 或通过服务管理器启动
```
3. 设置 MySQL root 密码（请记住此密码，后续需要配置到环境变量中）

### 4. HBuilderX 和微信开发者工具安装

1. 下载并安装 HBuilderX
2. 下载并安装微信开发者工具

---

## 数据库配置

### 数据库连接信息

| 配置项 | 说明 |
|-------|---|
| 数据库类型 | MySQL 8.0 |
| 主机地址 | localhost |
| 端口 | 3306 |
| 数据库名 | health_db |
| 用户名 | root |
| 密码 | 你的 MySQL root 密码 |

> ⚠️ **安全提示**: 密码等敏感信息请通过环境变量配置，不要硬编码在代码中。
| 字符集 | utf8mb4 |
| 排序规则 | utf8mb4_unicode_ci |

### 数据库初始化

**方式一：使用导入脚本（推荐）**

1. 确保项目目录中有 `database_backup` 文件夹
2. 双击运行 `import_database.bat`
3. 按照提示完成数据库导入

**方式二：手动初始化**

```bash
# 创建数据库
mysql -u root -p1234 -e "CREATE DATABASE IF NOT EXISTS health_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 导入表结构
mysql -u root -p1234 health_db < docs/数据库设计/init-all.sql
```

### 数据库导出（备份）

要备份当前数据库数据，双击运行 `export_database.bat` 脚本。

---

## 后端部署

### 1. 环境准备

```bash
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境 (Windows)
venv\Scripts\activate

# 激活虚拟环境 (Mac/Linux)
# source venv/bin/activate
```

### 2. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 3. 配置环境变量

> ⚠️ **重要**: 项目使用环境变量来管理敏感配置，请勿将敏感信息硬编码在代码中！

**方法一：复制模板文件（推荐）**

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑 .env 文件，填入你的实际配置
notepad .env   # Windows
# nano .env    # Linux/Mac
```

**方法二：手动创建 `.env` 文件**

在 `backend/` 目录下创建 `.env` 文件：

```env
# ==========================================
# 营养不良筛查与健康管理小程序 - 后端环境变量配置
# ==========================================

# ========== 数据库配置 ==========
# 格式: mysql+aiomysql://用户名:密码@主机:端口/数据库名
DATABASE_URL=mysql+aiomysql://root:你的密码@localhost:3306/health_db

# ========== JWT 配置 ==========
# 请使用随机生成的长字符串，可用命令生成: openssl rand -hex 32
JWT_SECRET_KEY=your-super-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=10080

# ========== 微信小程序配置 ==========
# 在微信公众平台获取: https://mp.weixin.qq.com/
WECHAT_APPID=your_wechat_appid
WECHAT_SECRET=your_wechat_secret

# ========== AI 服务配置（可选）==========
# 阿里云百炼 API Key，不使用可留空
DASHSCOPE_API_KEY=
DASHSCOPE_MODEL=qwen-turbo
```

> 📝 **说明**: `.env` 文件已被 `.gitignore` 忽略，不会上传到 Git 仓库

### 4. 初始化管理员账号

```bash
# 运行管理员初始化脚本
python init_admin.py
```

默认管理员账号：
- 用户名：`admin`
- 密码：`admin123`

---

## 前端部署

### 小程序前端 (uni-app)

```bash
# 安装依赖
npm install

# 开发模式运行 (微信小程序)
npm run dev:mp-weixin

# 或在 HBuilderX 中打开项目，点击运行到小程序模拟器
```

### 环境变量配置

在项目根目录创建 `.env.development` 文件：

```env
VITE_API_BASE_URL=http://localhost:8000/api/v1
VITE_UPLOAD_URL=http://localhost:8000/api/v1/upload
```

---

## 管理后台部署

### 1. 安装依赖

```bash
cd admin-web
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

管理后台将在 `http://localhost:5173` 启动。

### 3. 生产环境构建

```bash
npm run build
```

---

## 项目启动

### 完整启动流程

1. **启动数据库服务**
```bash
# Windows
net start mysql80

# 或使用项目中的脚本
mysql.bat
```

2. **启动后端服务**
```bash
cd backend
venv\Scripts\activate
python run.py
# 或
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

3. **启动小程序前端**
   - 在 HBuilderX 中打开项目
   - 选择"运行 → 运行到小程序模拟器"
   - 或使用命令：`npm run dev:mp-weixin`

4. **启动管理后台**（可选）
```bash
cd admin-web
npm run dev
```

### 服务端口说明

| 服务 | 端口 | 访问地址 |
|-----|-----|---------|
| 后端API | 8000 | http://localhost:8000 |
| 管理后台 | 5173 | http://localhost:5173 |
| 小程序 | - | 微信开发者工具 |

---

## 数据迁移

### 从当前环境导出数据

1. 确保所有服务正常运行
2. 双击运行 `export_database.bat`
3. 备份文件将保存在 `database_backup` 目录中

### 导入数据到新环境

1. 将整个项目文件夹复制到新环境
2. 确保新环境已安装所有必需软件
3. 双击运行 `import_database.bat`
4. 按提示确认导入操作

### 数据一致性保证

- 所有表结构和数据将完全一致
- 用户数据、配置数据、业务数据都会被迁移
- 管理员账号和权限设置会被保留

---

## 测试验证

### 1. 后端API测试

访问：http://localhost:8000/docs

- 查看API文档
- 测试各个接口是否正常

### 2. 数据库连接测试

```bash
# 测试数据库连接
mysql -u root -p1234 -e "USE health_db; SELECT COUNT(*) as user_count FROM users;"
```

### 3. 小程序功能测试

在微信开发者工具中：

1. 注册/登录功能
2. 健康筛查功能
3. 运动记录功能
4. 饮食记录功能
5. 商城功能
6. 社区功能

### 4. 管理后台测试

访问：http://localhost:5173

- 使用 admin/admin123 登录
- 测试各项管理功能

---

## 常见问题

### Q1: MySQL 服务启动失败

**问题**：`net start mysql80` 失败

**解决**：
1. 检查 MySQL 是否正确安装
2. 以管理员身份运行命令提示符
3. 检查服务名称是否正确（可能为 mysql 或 mysql80）

### Q2: 数据库连接失败

**问题**：后端报错 "Can't connect to MySQL server"

**解决**：
1. 确认 MySQL 服务正在运行
2. 检查 `backend/.env` 中的 `DATABASE_URL` 配置是否正确
3. 确认数据库密码正确
4. 确认数据库 `health_db` 已创建

### Q2.5: 找不到 .env 文件 / 环境变量未生效

**问题**：克隆项目后后端无法启动，提示配置错误

**解决**：
1. 确认已复制 `.env.example` 为 `.env`：
   ```bash
   cd backend
   cp .env.example .env
   ```
2. 编辑 `.env` 文件，填入正确的配置值
3. 确认 `.env` 文件在 `backend/` 目录下（不是项目根目录）
4. 重启后端服务

### Q3: Python 依赖安装失败

**问题**：`pip install -r requirements.txt` 失败

**解决**：
1. 确认 Python 版本为 3.10+
2. 升级 pip：`python -m pip install --upgrade pip`
3. 使用国内源：`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/`

### Q4: 小程序真机调试失败

**问题**：小程序无法在真机上运行

**解决**：
1. 在微信开发者工具中绑定微信号
2. 在微信公众平台配置合法域名
3. 检查小程序 AppID 配置

### Q5: 管理后台无法访问

**问题**：http://localhost:5173 无法访问

**解决**：
1. 确认管理后台服务已启动
2. 检查防火墙设置
3. 尝试更换浏览器

### Q6: 数据导入失败

**问题**：import_database.bat 执行失败

**解决**：
1. 确认 MySQL 服务正在运行
2. 检查数据库密码是否正确
3. 确认备份文件存在且完整
4. 以管理员身份运行脚本

---

## 部署清单

### ✅ 环境准备
- [ ] Node.js 18.x+ 已安装
- [ ] Python 3.10+ 已安装
- [ ] MySQL 8.0+ 已安装并启动
- [ ] HBuilderX 已安装
- [ ] 微信开发者工具已安装

### ✅ 环境变量配置（从 GitHub 克隆后必做）
- [ ] 已复制 `backend/.env.example` 为 `backend/.env`
- [ ] 已修改 `DATABASE_URL` 中的数据库密码
- [ ] 已设置 `JWT_SECRET_KEY`（生产环境）
- [ ] 已配置 `WECHAT_APPID` 和 `WECHAT_SECRET`（如需微信登录）
- [ ] 已配置 `DASHSCOPE_API_KEY`（如需 AI 功能）

### ✅ 数据库配置
- [ ] 数据库 `health_db` 已创建
- [ ] 所有数据表已导入
- [ ] 管理员账号已初始化

### ✅ 后端部署
- [ ] Python 虚拟环境已创建
- [ ] 依赖包已安装
- [ ] `.env` 配置文件已创建并配置正确
- [ ] 后端服务可正常启动（`python run.py`）

### ✅ 前端部署
- [ ] 小程序依赖已安装（`npm install`）
- [ ] 可在微信开发者工具中运行

### ✅ 管理后台部署
- [ ] 依赖已安装（`npm install`）
- [ ] 可在浏览器中访问（http://localhost:3000）

### ✅ 功能测试
- [ ] API 接口可正常调用（http://localhost:8000/docs）
- [ ] 数据库连接正常
- [ ] 小程序各项功能正常
- [ ] 管理后台各项功能正常

---

## 技术支持

如遇到问题，请：

1. 检查本手册的常见问题部分
2. 查看项目文档：`docs/` 目录
3. 检查服务日志输出
4. 联系项目维护者

---

**最后更新时间：** 2025年12月4日
**文档版本：** v1.1
**适用项目版本：** v1.5

---

## 更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| v1.1 | 2025-12-04 | 添加环境变量配置说明、快速开始章节、安全提示 |
| v1.0 | 2025-12-01 | 初始版本 |








