# 营养不良筛查与健康管理小程序 - 完整安装手册

## 项目概述

这是一个基于 uni-app + Vue 3 + FastAPI + MySQL 的全栈健康管理小程序，包含以下功能模块：
- 健康筛查与评估
- 运动打卡与记录
- 饮食记录与分析
- 商城购物
- 社区互动
- AI健康咨询
- 会员管理系统
- 后台管理系统

---

## 📋 目录

1. [环境要求](#环境要求)
2. [项目结构](#项目结构)
3. [环境搭建](#环境搭建)
4. [数据库配置](#数据库配置)
5. [后端部署](#后端部署)
6. [前端部署](#前端部署)
7. [管理后台部署](#管理后台部署)
8. [项目启动](#项目启动)
9. [数据迁移](#数据迁移)
10. [测试验证](#测试验证)
11. [常见问题](#常见问题)
12. [部署清单](#部署清单)

---

## 环境要求

### 必需软件

| 软件名称 | 版本要求 | 下载地址 | 说明 |
|---------|---------|---------|------|
| **Node.js** | 18.x+ | https://nodejs.org | 前端构建运行环境 |
| **Python** | 3.10+ | https://python.org | 后端运行环境 |
| **MySQL** | 8.0+ | https://mysql.com | 数据库服务器 |
| **HBuilderX** | 最新版 | https://www.dcloud.io/hbuilderx.html | uni-app开发工具 |
| **微信开发者工具** | 最新版 | https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html | 小程序调试工具 |

### 可选软件

| 软件名称 | 版本要求 | 说明 |
|---------|---------|------|
| **Redis** | 6.x+ | 缓存服务（可选） |
| **Git** | 最新版 | 版本控制 |

---

## 项目结构

```
营养不良筛查与健康管理小程序/
├── admin-web/                 # 管理后台前端 (Vue 3 + Element Plus)
├── backend/                   # Python后端 (FastAPI)
├── docs/                      # 项目文档
├── pages/                     # 小程序页面
├── static/                    # 小程序静态资源
├── stores/                    # Pinia状态管理
├── utils/                     # 工具函数
├── components/                # 公共组件
├── database_backup/           # 数据库备份文件 (运行导出脚本后生成)
├── export_database.bat        # 数据库导出脚本
├── import_database.bat        # 数据库导入脚本
├── package.json               # 小程序依赖配置
├── pages.json                 # 小程序页面配置
├── manifest.json              # 小程序清单配置
└── 完整安装手册.md           # 本文档
```

---

## 环境搭建

### 1. Node.js 安装

1. 下载并安装 Node.js 18.x+
2. 验证安装：
```bash
node --version
npm --version
```

### 2. Python 安装

1. 下载并安装 Python 3.10+
2. 验证安装：
```bash
python --version
pip --version
```

### 3. MySQL 安装

1. 下载并安装 MySQL 8.0+
2. 启动 MySQL 服务：
```bash
# Windows
net start mysql80

# 或通过服务管理器启动
```
3. 设置 root 密码为 `1234`（或修改配置文件中的密码）

### 4. HBuilderX 和微信开发者工具安装

1. 下载并安装 HBuilderX
2. 下载并安装微信开发者工具

---

## 数据库配置

### 数据库连接信息

| 配置项 | 值 |
|-------|---|
| 数据库类型 | MySQL 8.0 |
| 主机地址 | localhost |
| 端口 | 3306 |
| 数据库名 | health_db |
| 用户名 | root |
| 密码 | 1234 |
| 字符集 | utf8mb4 |
| 排序规则 | utf8mb4_unicode_ci |

### 数据库初始化

**方式一：使用导入脚本（推荐）**

1. 确保项目目录中有 `database_backup` 文件夹
2. 双击运行 `import_database.bat`
3. 按照提示完成数据库导入

**方式二：手动初始化**

```bash
# 创建数据库
mysql -u root -p1234 -e "CREATE DATABASE IF NOT EXISTS health_db DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 导入表结构
mysql -u root -p1234 health_db < docs/数据库设计/init-all.sql
```

### 数据库导出（备份）

要备份当前数据库数据，双击运行 `export_database.bat` 脚本。

---

## 后端部署

### 1. 环境准备

```bash
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境 (Windows)
venv\Scripts\activate

# 激活虚拟环境 (Mac/Linux)
# source venv/bin/activate
```

### 2. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt
```

### 3. 配置文件

创建 `.env` 文件：

```env
# ==================== 数据库配置 ====================
DATABASE_URL=mysql+aiomysql://root:1234@localhost:3306/health_db

# ==================== Redis 配置（可选）====================
REDIS_URL=redis://localhost:6379

# ==================== JWT 配置 ====================
JWT_SECRET_KEY=your-random-secret-key-change-this-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=10080

# ==================== 微信小程序配置 ====================
WECHAT_APPID=                    # 待填入
WECHAT_SECRET=                   # 待填入

# ==================== 阿里云百炼平台 ====================
DASHSCOPE_API_KEY=               # 待填入

# ==================== 暂缓配置（后续补充）====================
WECHAT_MCH_ID=                   # 微信支付商户号
ALIPAY_APP_ID=                   # 支付宝应用ID
TENCENT_MAP_KEY=                 # 腾讯地图服务Key
```

### 4. 初始化管理员账号

```bash
# 运行管理员初始化脚本
python init_admin.py
```

默认管理员账号：
- 用户名：`admin`
- 密码：`admin123`

---

## 前端部署

### 小程序前端 (uni-app)

```bash
# 安装依赖
npm install

# 开发模式运行 (微信小程序)
npm run dev:mp-weixin

# 或在 HBuilderX 中打开项目，点击运行到小程序模拟器
```

### 环境变量配置

在项目根目录创建 `.env.development` 文件：

```env
VITE_API_BASE_URL=http://localhost:8000/api/v1
VITE_UPLOAD_URL=http://localhost:8000/api/v1/upload
```

---

## 管理后台部署

### 1. 安装依赖

```bash
cd admin-web
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

管理后台将在 `http://localhost:5173` 启动。

### 3. 生产环境构建

```bash
npm run build
```

---

## 项目启动

### 完整启动流程

1. **启动数据库服务**
```bash
# Windows
net start mysql80

# 或使用项目中的脚本
mysql.bat
```

2. **启动后端服务**
```bash
cd backend
venv\Scripts\activate
python run.py
# 或
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

3. **启动小程序前端**
   - 在 HBuilderX 中打开项目
   - 选择"运行 → 运行到小程序模拟器"
   - 或使用命令：`npm run dev:mp-weixin`

4. **启动管理后台**（可选）
```bash
cd admin-web
npm run dev
```

### 服务端口说明

| 服务 | 端口 | 访问地址 |
|-----|-----|---------|
| 后端API | 8000 | http://localhost:8000 |
| 管理后台 | 5173 | http://localhost:5173 |
| 小程序 | - | 微信开发者工具 |

---

## 数据迁移

### 从当前环境导出数据

1. 确保所有服务正常运行
2. 双击运行 `export_database.bat`
3. 备份文件将保存在 `database_backup` 目录中

### 导入数据到新环境

1. 将整个项目文件夹复制到新环境
2. 确保新环境已安装所有必需软件
3. 双击运行 `import_database.bat`
4. 按提示确认导入操作

### 数据一致性保证

- 所有表结构和数据将完全一致
- 用户数据、配置数据、业务数据都会被迁移
- 管理员账号和权限设置会被保留

---

## 测试验证

### 1. 后端API测试

访问：http://localhost:8000/docs

- 查看API文档
- 测试各个接口是否正常

### 2. 数据库连接测试

```bash
# 测试数据库连接
mysql -u root -p1234 -e "USE health_db; SELECT COUNT(*) as user_count FROM users;"
```

### 3. 小程序功能测试

在微信开发者工具中：

1. 注册/登录功能
2. 健康筛查功能
3. 运动记录功能
4. 饮食记录功能
5. 商城功能
6. 社区功能

### 4. 管理后台测试

访问：http://localhost:5173

- 使用 admin/admin123 登录
- 测试各项管理功能

---

## 常见问题

### Q1: MySQL 服务启动失败

**问题**：`net start mysql80` 失败

**解决**：
1. 检查 MySQL 是否正确安装
2. 以管理员身份运行命令提示符
3. 检查服务名称是否正确（可能为 mysql 或 mysql80）

### Q2: 数据库连接失败

**问题**：后端报错 "Can't connect to MySQL server"

**解决**：
1. 确认 MySQL 服务正在运行
2. 检查数据库配置中的用户名和密码
3. 确认数据库 `health_db` 已创建

### Q3: Python 依赖安装失败

**问题**：`pip install -r requirements.txt` 失败

**解决**：
1. 确认 Python 版本为 3.10+
2. 升级 pip：`python -m pip install --upgrade pip`
3. 使用国内源：`pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/`

### Q4: 小程序真机调试失败

**问题**：小程序无法在真机上运行

**解决**：
1. 在微信开发者工具中绑定微信号
2. 在微信公众平台配置合法域名
3. 检查小程序 AppID 配置

### Q5: 管理后台无法访问

**问题**：http://localhost:5173 无法访问

**解决**：
1. 确认管理后台服务已启动
2. 检查防火墙设置
3. 尝试更换浏览器

### Q6: 数据导入失败

**问题**：import_database.bat 执行失败

**解决**：
1. 确认 MySQL 服务正在运行
2. 检查数据库密码是否正确
3. 确认备份文件存在且完整
4. 以管理员身份运行脚本

---

## 部署清单

### ✅ 环境准备
- [ ] Node.js 18.x+ 已安装
- [ ] Python 3.10+ 已安装
- [ ] MySQL 8.0+ 已安装并启动
- [ ] HBuilderX 已安装
- [ ] 微信开发者工具已安装

### ✅ 数据库配置
- [ ] 数据库 `health_db` 已创建
- [ ] 所有数据表已导入
- [ ] 管理员账号已初始化

### ✅ 后端部署
- [ ] Python 虚拟环境已创建
- [ ] 依赖包已安装
- [ ] `.env` 配置文件已创建
- [ ] 后端服务可正常启动

### ✅ 前端部署
- [ ] 小程序依赖已安装
- [ ] 环境变量已配置
- [ ] 可在微信开发者工具中运行

### ✅ 管理后台部署
- [ ] 依赖已安装
- [ ] 可在浏览器中访问

### ✅ 功能测试
- [ ] API 接口可正常调用
- [ ] 数据库连接正常
- [ ] 小程序各项功能正常
- [ ] 管理后台各项功能正常

---

## 技术支持

如遇到问题，请：

1. 检查本手册的常见问题部分
2. 查看项目文档：`docs/` 目录
3. 检查服务日志输出
4. 联系项目维护者

---

**最后更新时间：** 2025年12月1日
**文档版本：** v1.0
**适用项目版本：** v1.0








