# 十四、管理后台开发文档

> 本文档记录 Web 管理后台 (admin-web) 的实现详情。

---

## 1. 项目结构

```
admin-web/
├── src/
│   ├── api/                    # API 接口封装
│   │   ├── request.ts          # Axios 请求封装
│   │   ├── auth.ts             # 认证接口
│   │   ├── user.ts             # 用户管理接口
│   │   ├── audit.ts            # 内容审核接口
│   │   ├── product.ts          # 商品管理接口
│   │   ├── order.ts            # 订单管理接口
│   │   ├── stats.ts            # 统计接口
│   │   ├── setting.ts          # 系统设置接口
│   │   └── index.ts            # 统一导出
│   │
│   ├── assets/                 # 静态资源
│   │
│   ├── components/             # 公共组件
│   │
│   ├── layout/                 # 布局组件
│   │   └── MainLayout.vue      # 主布局（侧边栏+头部+内容区）
│   │
│   ├── router/                 # 路由配置
│   │   └── index.ts            # 路由定义 + 导航守卫
│   │
│   ├── store/                  # 状态管理 (Pinia)
│   │   ├── index.ts            # Pinia 实例
│   │   └── admin.ts            # 管理员状态
│   │
│   ├── views/                  # 页面组件
│   │   ├── Login.vue           # 登录页
│   │   ├── Dashboard.vue       # 仪表盘
│   │   ├── UserList.vue        # 用户管理
│   │   ├── ContentAudit.vue    # 内容审核
│   │   ├── ProductList.vue     # 商品管理
│   │   ├── OrderList.vue       # 订单管理
│   │   └── Settings.vue        # 系统设置
│   │
│   ├── App.vue                 # 根组件
│   ├── main.ts                 # 应用入口
│   ├── style.css               # 全局样式
│   └── env.d.ts                # 类型声明
│
├── public/                     # 公共资源
├── index.html                  # HTML 入口
├── package.json                # 项目配置
├── vite.config.ts              # Vite 配置
├── tsconfig.json               # TypeScript 配置
├── tailwind.config.js          # Tailwind CSS 配置
└── postcss.config.js           # PostCSS 配置
```

---

## 2. 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.x | 前端框架 |
| TypeScript | 5.x | 类型安全 |
| Vite | 5.x | 构建工具 |
| Element Plus | 2.x | UI 组件库 |
| Pinia | 2.x | 状态管理 |
| Vue Router | 4.x | 路由管理 |
| Axios | 1.x | HTTP 请求 |
| Tailwind CSS | 3.x | 原子化 CSS |
| ECharts | 5.x | 图表可视化 |

---

## 3. 页面功能

### 3.1 登录页 (Login.vue)

- 管理员账号密码登录
- JWT Token 存储
- 登录状态持久化
- 路由守卫保护

### 3.2 仪表盘 (Dashboard.vue)

- **数据概览卡片**
  - 总用户数
  - 今日订单
  - 今日收入
  - 今日打卡
  
- **图表展示**
  - 用户增长趋势（7日折线图）
  - 健康风险分布（饼图）
  
- **待处理事项**
  - 待审核内容
  - 待处理订单

### 3.3 用户管理 (UserList.vue)

- 用户列表（分页）
- 搜索筛选（关键词、状态、会员类型）
- 用户详情弹窗（基本信息、健康档案）
- 禁用/启用用户

### 3.4 内容审核 (ContentAudit.vue)

- Tab 切换（待审核/已通过/已拒绝）
- 内容类型切换（动态/评论）
- 审核操作（通过/拒绝）
- 拒绝原因输入

### 3.5 商品管理 (ProductList.vue)

- 商品卡片列表
- 搜索筛选（关键词、分类、上架状态）
- 新增/编辑商品弹窗
- 上架/下架操作
- 库存预警提示

### 3.6 订单管理 (OrderList.vue)

- 订单列表（分页）
- 搜索筛选（订单号、状态、日期范围）
- 订单详情弹窗
- 发货操作（快递公司、单号）
- 退款操作

### 3.7 系统设置 (Settings.vue)

- **积分配置** Tab
  - 签到奖励设置
  - 行为奖励设置
  
- **会员配置** Tab
  - 会员价格设置
  - 会员权益设置
  
- **订单配置** Tab
  - 自动取消时间
  - 自动确认收货时间
  - 免运费金额

---

## 4. API 对接

### 4.1 请求封装 (api/request.ts)

```typescript
// 基础配置
const service = axios.create({
  baseURL: 'http://localhost:8000/api/admin',
  timeout: 30000,
})

// 请求拦截器 - 自动添加 Token
service.interceptors.request.use((config) => {
  const token = localStorage.getItem('admin_token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// 响应拦截器 - 统一错误处理
service.interceptors.response.use(
  (response) => {
    // 处理业务错误码
    if (response.data.code !== 200) {
      ElMessage.error(response.data.message)
      return Promise.reject(response.data)
    }
    return response.data
  },
  (error) => {
    // 401 跳转登录
    if (error.response?.status === 401) {
      router.push('/login')
    }
    return Promise.reject(error)
  }
)
```

### 4.2 接口模块

| 模块 | 文件 | 接口数 |
|------|------|--------|
| 认证 | auth.ts | 3 |
| 用户管理 | user.ts | 3 |
| 内容审核 | audit.ts | 4 |
| 商品管理 | product.ts | 8 |
| 订单管理 | order.ts | 4 |
| 数据统计 | stats.ts | 4 |
| 系统设置 | setting.ts | 4 |

---

## 5. 状态管理

### 5.1 管理员状态 (store/admin.ts)

```typescript
export const useAdminStore = defineStore('admin', () => {
  // State
  const adminInfo = ref<AdminInfo | null>(null)
  const token = ref<string>(localStorage.getItem('admin_token') || '')

  // Getters
  const isLoggedIn = computed(() => !!token.value)
  const nickname = computed(() => adminInfo.value?.nickname || '管理员')

  // Actions
  async function login(username: string, password: string) { ... }
  async function fetchAdminInfo() { ... }
  async function logout() { ... }

  return { adminInfo, token, isLoggedIn, nickname, login, logout, ... }
})
```

---

## 6. 路由配置

### 6.1 路由定义

```typescript
const routes = [
  {
    path: '/',
    component: MainLayout,
    redirect: '/dashboard',
    meta: { requiresAuth: true },
    children: [
      { path: 'dashboard', component: Dashboard, meta: { title: '仪表盘' } },
      { path: 'users', component: UserList, meta: { title: '用户管理' } },
      { path: 'content', component: ContentAudit, meta: { title: '内容审核' } },
      { path: 'products', component: ProductList, meta: { title: '商品管理' } },
      { path: 'orders', component: OrderList, meta: { title: '订单管理' } },
      { path: 'settings', component: Settings, meta: { title: '系统设置' } },
    ]
  },
  { path: '/login', component: Login }
]
```

### 6.2 导航守卫

```typescript
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('admin_token')
  
  if (to.meta.requiresAuth && !token) {
    // 未登录跳转登录页
    next({ name: 'Login', query: { redirect: to.fullPath } })
  } else if (to.name === 'Login' && token) {
    // 已登录访问登录页跳转首页
    next({ name: 'Dashboard' })
  } else {
    next()
  }
})
```

---

## 7. 启动方式

### 7.1 开发环境

```bash
cd admin-web

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问 http://localhost:3000
```

### 7.2 生产构建

```bash
npm run build
# 输出到 dist/ 目录
```

---

## 8. 测试账号

| 账号 | 密码 | 角色 |
|------|------|------|
| admin | admin123 | 超级管理员 |

---

## 9. 设计规范

### 9.1 颜色系统

基于 Apple 风格设计：

```css
:root {
  --apple-blue: #0071e3;      /* 主色调 */
  --apple-dark: #1d1d1f;      /* 深色文字 */
  --apple-gray: #f5f5f7;      /* 背景灰 */
  --apple-text-gray: #86868b; /* 次要文字 */
  --apple-border: #d2d2d7;    /* 边框色 */
}
```

### 9.2 组件风格

- 圆角卡片设计
- 微妙阴影效果
- 简洁的表格样式
- 优雅的动画过渡

---

## 10. 注意事项

1. **Token 存储**：使用 `localStorage` 存储 `admin_token`
2. **权限控制**：路由守卫 + API 拦截器双重保护
3. **错误处理**：统一使用 Element Plus Message 提示
4. **数据刷新**：操作成功后自动刷新列表
5. **分页处理**：统一使用 Element Plus Pagination 组件














