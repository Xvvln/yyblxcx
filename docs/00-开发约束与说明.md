# 开发约束与说明

> **重要**：本文档定义了开发过程中必须遵守的约束条件和暂缓实现的功能说明。所有开发人员在开发前必须阅读本文档。

---

## 一、用户群体说明

### 1.1 目标用户构成

| 用户类型 | 占比 | 说明 |
|---------|------|-----|
| 普通成年用户 | 多数 | 主要用户群体 |
| 老年用户 | 少数 | 部分用户，需要适老化支持 |

### 1.2 适老化功能策略

- 适老化功能**必须实现**，但**默认关闭**
- 用户可在「设置」中手动开启「长辈模式」
- 长辈模式包含：
  - 字体放大（1.5倍）
  - 按钮放大（最小 56px）
  - 简化界面（隐藏次要功能）
  - 语音播报（可选）

```javascript
// 示例：长辈模式配置
const elderlyModeConfig = {
  enabled: false,  // 默认关闭
  fontSize: 1.5,   // 字体倍率
  minButtonSize: 56,
  simplifiedUI: true,
  voiceAssist: false
}
```

---

## 二、UI/UX 强制规范

### 2.1 禁止使用 Emoji

**小程序内部一律禁止使用任何 Emoji 表情符号**

| 场景 | 错误示例 | 正确示例 |
|-----|---------|---------|
| 按钮文字 | 提交 | 提交 |
| 提示信息 | 操作成功! | 操作成功 |
| 标题 | 我的积分 | 我的积分 |
| 状态标识 | 已完成 | 已完成 / 使用图标组件 |

### 2.2 图标与图片占位

**所有图标、图片位置暂时留空，使用占位符，等待后期设计稿填充**

```vue
<!-- 图标占位示例 -->
<view class="icon-placeholder">
  <!-- TODO: 替换为实际图标 -->
  <view class="placeholder-box"></view>
</view>

<!-- 图片占位示例 -->
<image 
  class="product-image" 
  src="/static/placeholder/default.png"
  mode="aspectFill"
/>
```

占位样式：
```css
.placeholder-box {
  width: 48rpx;
  height: 48rpx;
  background-color: #E5E5E5;
  border-radius: 8rpx;
}

.image-placeholder {
  width: 100%;
  height: 200rpx;
  background-color: #F5F5F7;
  display: flex;
  align-items: center;
  justify-content: center;
}
```

---

## 三、功能实现范围

### 3.1 健康筛查模块 - 仅前端

**当前阶段仅实现前端界面和页面跳转，技术内核暂不实现**

| 功能点 | 当前实现 | 暂缓实现 |
|-------|---------|---------|
| 问卷页面 | 页面UI、表单交互、数据收集 | - |
| 数据上传界面 | 上传按钮、进度显示 | 实际上传逻辑 |
| AI分析 | 结果展示页面（使用模拟数据） | AI模型调用、算法处理 |
| 硬件连接 | 连接界面、设备列表UI | 蓝牙连接、数据读取 |
| 面部识别 | 拍照界面、引导UI | 图像识别算法 |
| 膳食分析 | 拍照上传界面 | 食物识别AI |

```javascript
// 健康筛查 - 使用模拟数据
async function getHealthAnalysis(screeningId) {
  // TODO: 对接真实AI分析接口
  // 当前返回模拟数据
  return {
    riskLevel: 'low',
    suggestion: '您的健康状况良好，建议保持规律作息...',
    dietPlan: '...',
    exercisePlan: '...'
  }
}
```

### 3.2 运动模块 - GPS服务暂缓

**实时GPS定位服务后端暂不实现，前端做好接口预留**

| 功能 | 前端实现 | 后端状态 |
|-----|---------|---------|
| 运动类型选择 | 完整实现 | - |
| 计时器 | 完整实现 | - |
| GPS轨迹显示 | UI界面、地图组件 | **暂缓** - 需申请位置服务 |
| 轨迹上传 | 接口调用代码 | **暂缓** - 接口返回模拟成功 |
| 配速计算 | 前端本地计算 | - |
| 卡路里估算 | 前端本地计算 | - |

```javascript
// 后端GPS相关接口 - 暂缓实现
// 文件: backend/app/api/v1/sport.py

@router.post("/track/upload")
async def upload_gps_track(track_data: TrackUpload):
    """
    上传GPS轨迹数据
    
    TODO: 暂缓实现
    - 需要申请腾讯地图/高德地图位置服务
    - 需要配置服务器端地图API Key
    - 当前直接返回成功，不做实际存储
    """
    return {"code": 200, "message": "success", "data": {"track_id": "mock_id"}}
```

### 3.3 支付模块 - 后端暂缓

**支付功能后端暂不实现，前端完成支付流程UI**

| 功能 | 前端实现 | 后端状态 |
|-----|---------|---------|
| 支付方式选择 | 完整实现 | - |
| 订单确认页 | 完整实现 | - |
| 支付弹窗 | 完整实现 | - |
| 调起微信支付 | 接口调用代码 | **暂缓** - 需要商户资质 |
| 支付结果页 | 完整实现 | - |
| 订单状态更新 | 接口调用代码 | **暂缓** - 返回模拟成功 |

```python
# 后端支付接口 - 暂缓实现
# 文件: backend/app/api/v1/order.py

@router.post("/{order_id}/pay")
async def create_payment(order_id: int, pay_type: str):
    """
    发起支付
    
    TODO: 暂缓实现
    - 需要微信商户号、API密钥
    - 需要配置支付回调地址
    - 需要ICP备案和HTTPS
    - 当前直接返回模拟支付成功
    """
    # 模拟支付成功，直接更新订单状态
    return {
        "code": 200,
        "message": "模拟支付成功",
        "data": {
            "order_id": order_id,
            "status": "paid",
            "pay_time": datetime.now().isoformat()
        }
    }
```

### 3.4 AI健康助手 - 百炼平台

**使用阿里云百炼平台API，API Key配置项留空，其他功能完整实现**

```python
# 文件: backend/app/config.py

class Settings(BaseSettings):
    # 百炼平台配置
    DASHSCOPE_API_KEY: str = ""  # TODO: 填入百炼平台API Key
    DASHSCOPE_MODEL: str = "qwen-turbo"  # 默认模型
    
    class Config:
        env_file = ".env"
```

```python
# 文件: backend/app/services/ai_service.py

import dashscope
from dashscope import Generation
from app.config import settings

class AIHealthAssistant:
    """AI健康助手 - 基于百炼平台"""
    
    def __init__(self):
        dashscope.api_key = settings.DASHSCOPE_API_KEY
        
    async def chat(self, user_message: str, context: dict = None) -> str:
        """
        与AI健康助手对话
        
        Args:
            user_message: 用户消息
            context: 用户健康档案等上下文
        
        Returns:
            AI回复内容
        """
        if not settings.DASHSCOPE_API_KEY:
            return "AI服务未配置，请联系管理员设置API Key"
        
        system_prompt = self._build_system_prompt(context)
        
        response = Generation.call(
            model=settings.DASHSCOPE_MODEL,
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": user_message}
            ]
        )
        
        if response.status_code == 200:
            return response.output.text
        else:
            return f"AI服务异常: {response.message}"
    
    def _build_system_prompt(self, context: dict) -> str:
        """构建系统提示词"""
        base_prompt = """你是一个专业的健康管理助手，具备营养学和运动科学知识。
请根据用户的问题提供专业、友善的健康建议。

注意事项：
1. 你的建议仅供参考，不能替代专业医疗诊断
2. 对于严重健康问题，建议用户及时就医
3. 回答要简洁明了，适合普通用户理解
"""
        if context:
            base_prompt += f"\n\n用户健康档案：\n{context}"
        
        return base_prompt
```

---

## 四、管理后台说明

### 4.1 平台架构

| 端 | 技术栈 | 说明 |
|---|-------|-----|
| 小程序端 | uni-app | 面向C端用户 |
| **Web管理端** | Vue 3 + Element Plus | 面向平台管理员 |
| 后端API | FastAPI | 同时服务小程序和Web端 |

### 4.2 Web管理端功能

```
admin-web/
├── 用户管理
│   ├── 用户列表
│   ├── 用户详情
│   └── 封禁/解封
├── 内容审核
│   ├── 动态审核
│   ├── 评论审核
│   └── 举报处理
├── 商品管理
│   ├── 商品列表
│   ├── 商品编辑
│   ├── 分类管理
│   └── 库存管理
├── 订单管理
│   ├── 订单列表
│   ├── 订单详情
│   ├── 发货管理
│   └── 退款处理
├── 数据统计
│   ├── 用户统计
│   ├── 订单统计
│   └── 健康数据统计
└── 系统设置
    ├── 积分规则
    ├── 会员配置
    └── 系统参数
```

---

## 五、暂缓功能清单汇总

| 模块 | 功能 | 原因 | 优先级 |
|-----|------|-----|-------|
| 健康筛查 | AI分析算法 | 需要训练模型 | P2 |
| 健康筛查 | 硬件蓝牙连接 | 需要硬件配合 | P2 |
| 健康筛查 | 面部识别 | 需要AI服务 | P2 |
| 健康筛查 | 膳食图像识别 | 需要AI服务 | P2 |
| 运动 | GPS轨迹后端存储 | 需要地图服务资质 | P1 |
| 支付 | 微信/支付宝支付 | 需要商户资质 | P1 |
| 设备 | 智能手环接入 | 需要硬件SDK | P3 |
| 设备 | 体重秤接入 | 需要硬件SDK | P3 |

---

## 六、环境变量模板

```env
# .env 文件模板

# 数据库
DATABASE_URL=mysql+aiomysql://user:password@localhost:3306/health_db

# Redis
REDIS_URL=redis://localhost:6379

# JWT
JWT_SECRET_KEY=your-secret-key-here
JWT_ALGORITHM=HS256
JWT_EXPIRE_MINUTES=10080

# 百炼平台 AI
DASHSCOPE_API_KEY=        # TODO: 填入API Key

# 微信小程序
WECHAT_APPID=             # TODO: 填入AppID
WECHAT_SECRET=            # TODO: 填入Secret

# 微信支付（暂缓）
WECHAT_MCH_ID=            # TODO: 商户号
WECHAT_API_KEY=           # TODO: API密钥

# 地图服务（暂缓）
TENCENT_MAP_KEY=          # TODO: 腾讯地图Key
```

---

## 七、代码注释规范

对于暂缓实现的功能，必须添加清晰的注释说明：

```python
# Python 示例
def process_payment(order_id: int):
    """
    处理支付
    
    TODO: 暂缓实现
    原因: 需要微信商户资质
    当前: 返回模拟支付成功
    后续: 对接微信支付API
    """
    pass
```

```javascript
// JavaScript 示例
async function uploadGPSTrack(trackData) {
  /**
   * 上传GPS轨迹
   * 
   * TODO: 暂缓实现
   * 原因: 后端GPS服务未开通
   * 当前: 本地存储，模拟上传成功
   * 后续: 对接后端轨迹存储接口
   */
}
```


